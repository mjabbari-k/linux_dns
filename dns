#!/bin/sh
# dns - interactive DNS selector.
# Delegates all NetworkManager changes to setdns/nodns to keep logic centralized.

set -e

SETDNS="${SETDNS:-/usr/local/bin/setdns}"
NODNS="${NODNS:-/usr/local/bin/nodns}"

if [ ! -x "$SETDNS" ]; then
  echo "Error: setdns not found or not executable at: $SETDNS"
  echo "Install it or set SETDNS=/path/to/setdns"
  exit 1
fi

if [ ! -x "$NODNS" ]; then
  echo "Error: nodns not found or not executable at: $NODNS"
  echo "Install it or set NODNS=/path/to/nodns"
  exit 1
fi

apply_dns() {
  "$SETDNS" "$1"
}

reset_dns() {
  "$NODNS"
}

while true; do
  clear
  echo "=============================================================="
  echo "|			 DNS Selector			     |"
  echo "=============================================================="
  echo ""
  echo "  1) Google DNS		2) Cloudflare		3) Yandex"
  echo "  4) Shecan		5) Electro		6) 403"
  echo "  7) Quad9              8) OpenDNS 		9) CleanBrowsing (Sec)"
  echo "  10) Add Your DNS by editing dns script "
  echo ""
  echo "  e) Reset to automatic DNS"
  echo "  q) Quit"
  echo ""
  printf "Select option: "
  read -r choice

  case "$choice" in
    1) apply_dns "8.8.8.8,8.8.4.4";;
    2) apply_dns "1.1.1.1,1.0.0.1";;
    3) apply_dns "77.88.8.8,77.88.8.1";;
    4) apply_dns "178.22.122.100,185.51.200.2";;
    5) apply_dns "78.157.42.100,78.157.42.101";;
    6) apply_dns "10.202.10.202,10.202.10.102";;
    7) apply_dns "9.9.9.9,149.112.112.112";;
    8) apply_dns "208.67.222.222,208.67.220.220";;
    9) apply_dns "185.228.168.9,185.228.169.9";;
    10) apply_dns "add your first and second dns and separate using ,";;
    e|E) reset_dns;;
    q|Q) exit 0;;
    *) echo "Invalid option."; sleep 1;;
  esac

  echo ""
  echo "Press Enter to continue..."
  read -r _
done
