#!/bin/sh
# dns - interactive DNS selector.
# Delegates all NetworkManager changes to setdns/nodns to keep logic centralized.

set -e

SETDNS="${SETDNS:-/usr/local/bin/setdns}"
NODNS="${NODNS:-/usr/local/bin/nodns}"

if [ ! -x "$SETDNS" ]; then
  echo "Error: setdns not found or not executable at: $SETDNS"
  echo "Install it or set SETDNS=/path/to/setdns"
  exit 1
fi

if [ ! -x "$NODNS" ]; then
  echo "Error: nodns not found or not executable at: $NODNS"
  echo "Install it or set NODNS=/path/to/nodns"
  exit 1
fi

apply_dns() {
  "$SETDNS" "$1"
}

reset_dns() {
  "$NODNS"
}

while true; do
  clear
  echo "==============================="
  echo " DNS Selector"
  echo "==============================="
  echo ""
  echo "  1) Google DNS            8.8.8.8,8.8.4.4"
  echo "  2) Cloudflare            1.1.1.1,1.0.0.1"
  echo "  3) Quad9                 9.9.9.9,149.112.112.112"
  echo "  4) OpenDNS               208.67.222.222,208.67.220.220"
  echo "  5) CleanBrowsing (Sec)   185.228.168.9,185.228.169.9"
  echo "  6) AdGuard DNS           94.140.14.14,94.140.15.15"
  echo "  7) NextDNS (example)     45.90.28.0,45.90.30.0"
  echo ""
  echo "  e) Reset to automatic DNS"
  echo "  q) Quit"
  echo ""
  printf "Select option: "
  read -r choice

  case "$choice" in
    1) apply_dns "8.8.8.8,8.8.4.4";;
    2) apply_dns "1.1.1.1,1.0.0.1";;
    3) apply_dns "9.9.9.9,149.112.112.112";;
    4) apply_dns "208.67.222.222,208.67.220.220";;
    5) apply_dns "185.228.168.9,185.228.169.9";;
    6) apply_dns "94.140.14.14,94.140.15.15";;
    7) apply_dns "45.90.28.0,45.90.30.0";;
    e|E) reset_dns;;
    q|Q) exit 0;;
    *) echo "Invalid option."; sleep 1;;
  esac

  echo ""
  echo "Press Enter to continue..."
  read -r _
done
